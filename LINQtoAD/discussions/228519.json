[
  {
    "Id": "498256",
    "ThreadId": "228519",
    "Html": "<p>The memberof attribute of user schema not working.&nbsp; Using VS2010.&nbsp; Any idea why?&nbsp; Always returns empty array.</p>\r\n<p>The member attribute of group schema works.&nbsp; Weird.&nbsp; Heres my code for the entities:\r\n<div style=\"color:black;background-color:white\">\r\n<pre> [DirectorySchema(<span style=\"color:#a31515\">&quot;user&quot;</span>, <span style=\"color:blue\">typeof</span>(IADsUser))]\r\n    <span style=\"color:blue\">public</span> <span style=\"color:blue\">class</span> ADUser : DirectoryEntity\r\n    {\r\n        <span style=\"color:blue\">#region</span> General\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;cn&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Name\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;givenName&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> FirstName\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;initials&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Initials\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;sn&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> LastName\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;displayName&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> DisplayName\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;description&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Description\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;physicalDeliveryOfficeName&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Office\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;mail&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Email\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;wWWHomePage&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> HomePage\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        <span style=\"color:blue\">#endregion</span>\r\n\r\n        <span style=\"color:blue\">#region</span> Address\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;streetAddress&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Street\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;postOfficeBox&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> POBox\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;l&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> City\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;st&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> State\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;postalCode&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Zip\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;c&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Country\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        <span style=\"color:blue\">#endregion</span>\r\n\r\n        <span style=\"color:blue\">#region</span> Account\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;userPrincipalName&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> UserLogonName\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;sAMAccountName&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> PreWin2kLogonName\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;userAccountControl&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> Int32 AccountDisabled\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        <span style=\"color:blue\">#endregion</span>\r\n\r\n        <span style=\"color:blue\">#region</span> Phone\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;homePhone&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> HomePhone\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;pager&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Pager\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;mobile&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Mobile\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;facsimileTelephoneNumber&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Fax\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;ipPhone&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> IpPhone\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        <span style=\"color:blue\">#endregion</span>\r\n\r\n        <span style=\"color:blue\">#region</span> Organization\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;title&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Title\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;department&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Department\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;company&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Company\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;manager&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> ManagerLdap\r\n        {\r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>;\r\n        }\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> ManagerName\r\n        {\r\n            <span style=\"color:blue\">get</span>\r\n            {\r\n                <span style=\"color:blue\">string</span> o = ManagerLdap;\r\n                <span style=\"color:blue\">if</span> (!<span style=\"color:blue\">string</span>.IsNullOrEmpty(o))\r\n                {\r\n                    <span style=\"color:blue\">string</span>[] arr = o.Split(<span style=\"color:#a31515\">','</span>);\r\n\r\n                    <span style=\"color:blue\">return</span> arr[0].Replace(<span style=\"color:#a31515\">&quot;CN=&quot;</span>, <span style=\"color:blue\">string</span>.Empty);\r\n                }\r\n\r\n                <span style=\"color:blue\">return</span> <span style=\"color:blue\">null</span>;\r\n            }\r\n            <span style=\"color:blue\">set</span> { }\r\n\r\n        }\r\n        <span style=\"color:blue\">#endregion</span>\r\n\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;memberOf&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span>[] Groups\r\n        { \r\n            <span style=\"color:blue\">get</span>;\r\n            <span style=\"color:blue\">set</span>; \r\n        }\r\n    }\r\n\r\n    [DirectorySchema(<span style=\"color:#a31515\">&quot;group&quot;</span>)]\r\n    <span style=\"color:blue\">public</span> <span style=\"color:blue\">class</span> ADGroup\r\n    {\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> Name { <span style=\"color:blue\">get</span>; <span style=\"color:blue\">set</span>; }\r\n\r\n        [DirectoryAttribute(<span style=\"color:#a31515\">&quot;member&quot;</span>)]\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span>[] Members { <span style=\"color:blue\">get</span>; <span style=\"color:blue\">set</span>; }\r\n    }\r\n</pre>\r\n</div>\r\n</p>",
    "PostedDate": "2010-09-24T15:18:20.683-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "498283",
    "ThreadId": "228519",
    "Html": "<p>I was pulling my own account which is a member of domain admins only.&nbsp; No groups returned.</p>\r\n<p>&nbsp;</p>\r\n<p>I changed to a co worker he is part of 3 groups including Domain Admins, only returns 2 that are not Domain Admins.&nbsp; Why?</p>\r\n<p>In the Group class Members for Domain Admin I do not see my account. Any idea?</p>\r\n<p>I added myself to Domain Users and that is the only group returned.</p>\r\n<p>Any help will be much appreciated.</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2010-09-24T16:41:25.96-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "499020",
    "ThreadId": "228519",
    "Html": "<p>Apparently, the Primary Group is not listed in the memberOf attribute list.&nbsp; So I had to use primaryGroupID attribute, and then find the name and add it to the memberOf list.&nbsp; Here is the function to get the name of primary group:\r\n<div style=\"color:black;background-color:white\">\r\n<pre> <span style=\"color:blue\">private</span> <span style=\"color:blue\">string</span> GetPrimaryGroup()\r\n        {\r\n            DirectoryEntry aDomainEntry = System.DirectoryServices.ActiveDirectory.Domain.GetCurrentDomain().GetDirectoryEntry();\r\n\r\n            <span style=\"color:blue\">int</span> primaryGroupID = PrimaryGroupID;\r\n            <span style=\"color:blue\">byte</span>[] objectSid = (<span style=\"color:blue\">byte</span>[])ObjectSid;\r\n\r\n            StringBuilder escapedGroupSid = <span style=\"color:blue\">new</span> StringBuilder();\r\n\r\n            <span style=\"color:green\">// Copy over everything but the last four bytes(sub-authority)</span>\r\n            <span style=\"color:green\">// Doing so gives us the RID of the domain</span>\r\n            <span style=\"color:blue\">for</span> (<span style=\"color:blue\">uint</span> i = 0; i &lt; objectSid.Length - 4; i++)\r\n            {\r\n                escapedGroupSid.AppendFormat(<span style=\"color:#a31515\">&quot;\\\\{0:x2}&quot;</span>, objectSid[i]);\r\n            }\r\n\r\n            <span style=\"color:green\">//Add the primaryGroupID to the escape string to build the SID of the primaryGroup</span>\r\n            <span style=\"color:blue\">for</span> (<span style=\"color:blue\">uint</span> i = 0; i &lt; 4; i++)\r\n            {\r\n                escapedGroupSid.AppendFormat(<span style=\"color:#a31515\">&quot;\\\\{0:x2}&quot;</span>, (primaryGroupID &amp; 0xFF));\r\n                primaryGroupID &gt;&gt;= 8;\r\n            }\r\n\r\n            <span style=\"color:green\">//Search the directory for a group with this SID</span>\r\n            DirectorySearcher searcher = <span style=\"color:blue\">new</span> DirectorySearcher();\r\n            <span style=\"color:blue\">if</span> (aDomainEntry != <span style=\"color:blue\">null</span>)\r\n            {\r\n                searcher.SearchRoot = aDomainEntry;\r\n            }\r\n\r\n            searcher.Filter = <span style=\"color:#a31515\">&quot;(&amp;(objectCategory=Group)(objectSID=&quot;</span> + escapedGroupSid.ToString() + <span style=\"color:#a31515\">&quot;))&quot;</span>;\r\n            searcher.PropertiesToLoad.Add(<span style=\"color:#a31515\">&quot;distinguishedName&quot;</span>);\r\n\r\n            <span style=\"color:blue\">string</span> o = searcher.FindOne().Properties[<span style=\"color:#a31515\">&quot;distinguishedName&quot;</span>][0].ToString();\r\n            <span style=\"color:blue\">if</span> (!<span style=\"color:blue\">string</span>.IsNullOrEmpty(o))\r\n            {\r\n                <span style=\"color:blue\">string</span>[] arr = o.Split(<span style=\"color:#a31515\">','</span>);\r\n\r\n                <span style=\"color:blue\">return</span> arr[0].Replace(<span style=\"color:#a31515\">&quot;CN=&quot;</span>, <span style=\"color:blue\">string</span>.Empty);\r\n            }\r\n\r\n            <span style=\"color:blue\">return</span> <span style=\"color:blue\">null</span>;\r\n        }\r\n</pre>\r\n</div>\r\n</p>",
    "PostedDate": "2010-09-27T09:39:06.053-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]